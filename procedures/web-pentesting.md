# Web Application Pentesting Procedure

## Summary

Note that this is flexible, and can be adjusted on a case-by-case basis as necessary. More detailed tips are available in `pentesting/Methodologies.md`.

1. **Manual spidering**
   
   Get a feel for the target, browse the site manually, using something like Burp to keep track of pages visited and such. Make sure to go through any registration/login/forgot password flows.
2. **Automated spidering**
   
   Use Burp/dirb/dirbuster/wfuzz to automatically find anything you missed when searching manually. Definitely make use of multiple tools and wordlists, to get the most information.
3. **Vulnerability-search: Low-hanging Fruit**
   
   Using the results of the intial recon, look for some easy wins. Search exploit-db and cve-details for vulns in frameworks/CMSes used in the app. Quickly investigate anything that immediately stands out as promising from your manual spidering (e.g. questionable aspects of the forgot-password process)
4. **Vulnerability-search: Higher-hanging Fruit**
   
   Investigate more closely the results of your recon. Look for any and all sources of client input, and explore how those might be exploited. Build up maps of authentication flows and similar, to help inform this process.
5. **Exploitation**

   Use the outputs of Steps 4 and 5 to exploit the app. Chain exploits where appropriate (e.g. utilise an unauthenticated privesc, then and authenticated RCE, to get a shell on the server)
6. **Post-exploitation**

   Switch to network/OS pentesting and privesc techniques if appropriate, and/or take steps to ensure persistence and stealth (clean out logs, drop a cronjob or modify app code to run the reverse shell, etc.)
7. **Writeup**
    
## In-Depth

- Reconnaisance:
  - Manual exploration of website
    - Take a look around the pages, see the layouts, naming conventions, etc.
    - Go into dev tools and look at the HTTP response headers
      - Server type (windows/IIS, Linux, etc)
      - Authorisation headers (Bearer tokens - are they using JWT? Can you use null signing on the JWTs?)
      - Cookies (PHP cookies etc)
    - Quick peruse of `robots.txt`
    - Burpsuite can help keep track of the pages that have been visited and how they link to one another
  - Dirbuster
    - Tailor the scan to the target somewhat
      - Look for file extensions appropriate for target type (`php` for PHP servers, `aspx` for .NET, etc.)
      - If it's using a CMS, potentially make a small wordlist containing common directories for that CMS.
  - WFuzz
    - Can be used to augment, or as an alternative to, Dirbuster.
    - Can also be further used for probing for SQLi vulns and the like.
    - Comes with its own wordlists, which can be worth cross-pollinating with the dirbuster wordlists
  - Nikto
    - Can be used to search for common third-party components
  - DNS lookups
    - Can we do zone transfers?
    - Resolve IPs
    - etc.
- Vulnerability Discovery
  - Investigate any obvious low-hanging fruit from the recon phase
    - Exposed admin consoles, that kind of thing
  - Search for publically-disclosed vulnerabilities in the technologies in use.
    - Focusing on RCEs and other severe vulns.
    - Don't need to care about low-severity ones.
  - Client-controlled areas
    - Anywhere there is input from the client side, we want to fuzz or otherwise determine whether/what kind of sanitisation is conducted.
      - URLs
      - Login fields
      - Comments
      - Profile info
      - Signup fields
      - Cookies
      - HTTP headers
    - We want to look for possible SQL/NoSQL injections, XSS, predictable IDs, crackable/replayable/spoofable tokens, etc. These may need to be blind, remember.
  - Make sure not to ignore a strong vulnerability just because it requires creds you don't have yet. Take note of it, and keep it in the back pocket for when you _do_ gain those creds.
- Exploitation
  - Use the output of the previous step
  - Decide which ones look most promising
  - Decide upon a route to root, as it were.
  - Possible exploit paths:
    - predictable session tokens
      - Weak crypto (e.g. ECB, or CBC - which can be attacked using Burpsuite bitflipping attack)
      - sequential tokens
      - `None` JWT hashing algo
      - Weak token-to-user mapping
      - Replayable tokens
      - Etc.
    - SQLi
    - NoSQLi
    - Template injection
    - HTML/Javascript injection
    - CVEs
- Writeup
  - Write up report
  - Narrative
    - A technical walkthrough of how the system was compromised
  - Vulnerabilities discovered, their mitigations, and severity