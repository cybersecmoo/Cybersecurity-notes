## Network Pentesting

- Reconnaisance:
  - NMap
    - Quick scan: `nmap -v -sC -sS -oA [filename] [host]`
    - Then a full scan: `nmap -v -p- -oA [filename] [host]`
  - DNS lookups
    - Can we do zone transfers?
    - Resolve IPs
    - etc.
  - LDAP/SMB/RPC recon
    - `ldapsearch`
    - `rpcclient`
    - `crackmapexec` (for SMB recon etc.)
    - `smbclient`
    - `showmount`
    - Impacket recon scripts (`GetNPUsers` etc)
- Vulnerability Discovery
  - Investigate any obvious low-hanging fruit from the recon phase
    - Exposed NFS shares, etc.
  - Search for publically-disclosed vulnerabilities in the technologies in use.
    - Focusing on RCEs and other severe vulns.
    - Don't need to care about low-severity ones.
  - Null/anonymous authentication-based ways to obtain hashes
  - Make sure not to ignore a strong vulnerability just because it requires creds you don't have yet. Take note of it, and keep it in the back pocket for when you _do_ gain those creds.
- Exploitation
  - Use the output of the previous step
  - Decide which ones look most promising
  - Decide upon a route to root, as it were.
  - Quick bruteforcing of domain user credentials
  - Kerberoast/ASReproast etc.
- Foothold reconnaisance
  - With a basic foothold as a low-privilege user, start looking at:
    - More LDAP reconnaisance (`ldapsearch`, `crackmapexec`, etc.)
    - `BloodHound` if we don't care too much about stealth. With the `stealth` flag if we kinda care about stealth, but not a lot (e.g. we don't expect an active or particularly timely SOC response)
    - Look around accessible directories
      - See if config is visible
      - Backups of e.g. ssh creds
    - Search around the registry if readable
    - `sudo -l`
    - `WinPEAS`
    - Potentially running all this via an in-memory shell
- Privilege Escalation
  - Use the output of the previous
  - If on windows, look for token permissions
    - Can we add ourselves to groups?
    - Can we impersonate things?
    - Can we dump hashes?
    - Use our `BloodHound` output if we used that
  - If on linux, start looking at:
    - Passwordless sudo access
    - Shared passwords (does a system account shared a pw with a human user?)
    - Kernel privilege escalation methods
    - GTFOBins
    - Exposed SSH keys
- Lateral movement/usage of access
  - If not already persistent, now is the time to gain persistence
    - Drop executables/DLLs
    - Replace service executables (unquoted service paths)
    - Use reg keys
  -
- Writeup
  - Write up report
  - Narrative
  - Vulnerabilities discovered, their mitigations, and severity
