# Methodologies #

## Web Application Pentesting ##

- Reconnaisance:
  - Manual exploration of website
    - Take a look around the pages, see the layouts, naming conventions, etc.
    - Go into dev tools and look at the HTTP response headers
      - Server type (windows/IIS, Linux, etc)
      - Authorisation headers (Bearer tokens - are they using JWT? Can you use null signing on the JWTs?)
      - Cookies (PHP cookies etc)
    - Quick peruse of `robots.txt`
    - Burpsuite can help keep track of the pages that have been visited and how they link to one another
  - Dirbuster
    - Tailor the scan to the target somewhat
      - Look for file extensions appropriate for target type (`php` for PHP servers, `aspx` for .NET, etc.)
      - If it's using a CMS, potentially make a small wordlist containing common directories for that CMS.
  - WFuzz
    - Can be used to augment, or as an alternative to, Dirbuster. 
    - Can also be further used for probing for SQLi vulns and the like.
    - Comes with its own wordlists, which can be worth cross-pollinating with the dirbuster wordlists
  - Nikto
    - Can be used to search for common third-party components
  - DNS lookups
    - Can we do zone transfers?
    - Resolve IPs
    - etc.
- Vulnerability Discovery
  - Investigate any obvious low-hanging fruit from the recon phase
    - Exposed admin consoles, that kind of thing
  - Search for publically-disclosed vulnerabilities in the technologies in use.
    - Focusing on RCEs and other severe vulns. 
    - Don't need to care about low-severity ones.
  - Client-controlled areas
    - Anywhere there is input from the client side, we want to fuzz or otherwise determine whether/what kind of sanitisation is conducted.
      - URLs
      - Login fields
      - Comments
      - Profile info
      - Signup fields
      - Cookies
      - HTTP headers
    - We want to look for possible SQL/NoSQL injections, XSS, predictable IDs, crackable/replayable/spoofable tokens, etc. These may need to be blind, remember.
  - Make sure not to ignore a strong vulnerability just because it requires creds you don't have yet. Take note of it, and keep it in the back pocket for when you *do* gain those creds.
- Exploitation
  - Use the output of the previous step
  - Decide which ones look most promising
  - Decide upon a route to root, as it were.
  - Possible exploit paths:
    - predictable session tokens 
      - Weak crypto (e.g. ECB, or CBC - which can be attacked using Burpsuite bitflipping attack)
      - sequential tokens
      - `None` JWT hashing algo
      - Weak token-to-user mapping
      - Replayable tokens
      - Etc.
    - SQLi
    - NoSQLi
    - Template injection
    - HTML/Javascript injection
    - CVEs
- Writeup
  - Write up report
  - Narrative
    - A technical walkthrough of how the system was compromised
  - Vulnerabilities discovered

## Network Pentesting ##

- Reconnaisance:
  - NMap
    - Quick scan: `nmap -v -sC -sS -oA [filename] [host]`
    - Then a full scan: `nmap -v -p- -oA [filename] [host]`
  - DNS lookups
    - Can we do zone transfers?
    - Resolve IPs
    - etc.
  - LDAP/SMB/RPC recon
    - `ldapsearch`
    - `rpcclient`
    - `crackmapexec` (for SMB recon etc.)
    - `smbclient`
    - `showmount`
    - Impacket recon scripts (`GetNPUsers` etc)
- Vulnerability Discovery
  - Investigate any obvious low-hanging fruit from the recon phase
    - Exposed NFS shares, etc.
  - Search for publically-disclosed vulnerabilities in the technologies in use.
    - Focusing on RCEs and other severe vulns. 
    - Don't need to care about low-severity ones.
  - Null/anonymous authentication-based ways to obtain hashes
  - Make sure not to ignore a strong vulnerability just because it requires creds you don't have yet. Take note of it, and keep it in the back pocket for when you *do* gain those creds.
- Exploitation
  - Use the output of the previous step
  - Decide which ones look most promising
  - Decide upon a route to root, as it were.
  - Quick bruteforcing of domain user credentials
  - Kerberoast/ASReproast etc.
- Foothold reconnaisance
  - With a basic foothold as a low-privilege user, start looking at:
    - More LDAP reconnaisance (`ldapsearch`, `crackmapexec`, etc.)
    - `BloodHound` if we don't care too much about stealth. With the `stealth` flag if we kinda care about stealth, but not a lot (e.g. we don't expect an active or particularly timely SOC response)
    - Look around accessible directories
      - See if config is visible
      - Backups of e.g. ssh creds
    - Search around the registry if readable
    - `sudo -l`
    - `WinPEAS`
    - Potentially running all this via an in-memory shell
- Privilege Escalation
  - Use the output of the previous
  - If on windows, look for token permissions
    - Can we add ourselves to groups?
    - Can we impersonate things?
    - Can we dump hashes?
    - Use our `BloodHound` output if we used that
  - If on linux, start looking at:
    - Passwordless sudo access
    - Shared passwords (does a system account shared a pw with a human user?)
    - Kernel privilege escalation methods
    - GTFOBins
    - Exposed SSH keys
- Lateral movement/usage of access
  - If not already persistent, now is the time to gain persistence
    - Drop executables/DLLs
    - Replace service executables (unquoted service paths)
    - Use reg keys
  - 
- Writeup
  - Write up report
  - Narrative
  - Vulnerabilities discovered